# Story 1.2: Observability Setup

## Status
- Approved

## Story
**As an** SRE,
**I want** the service to be instrumented with OpenTelemetry,
**so that** I can trace requests and monitor its performance in a standardized way.

## Acceptance Criteria
1. The OpenTelemetry SDK is initialized when the service starts.
2. A TracerProvider and MeterProvider are configured.
3. An OTLP exporter is configured to send telemetry data to a collector.
4. Helper functions are available to easily get a `Tracer` and `Meter` instance for use throughout the application.
5. A simple "application.startup" span is successfully created and exported when the application initializes, verifiable in a telemetry backend.

## Tasks / Subtasks
- [ ] Task 1: Add OpenTelemetry Dependencies (AC: 1)
  - [ ] Add the required OpenTelemetry Go modules to `go.mod`.
- [ ] Task 2: Implement Telemetry Initialization (AC: 1, 2, 3)
  - [ ] Create a new package `internal/observability`.
  - [ ] In `internal/observability/telemetry.go`, implement `InitTracer()` and `InitMeter()` functions.
  - [ ] These functions should configure the OTLP exporter to send data to a collector (endpoint configured via environment variables).
- [ ] Task 3: Provide Accessor Functions (AC: 4)
  - [ ] Implement helper functions to provide easy access to the configured `Tracer` and `Meter` instances.
- [ ] Task 4: Integrate into Main Application (AC: 5)
  - [ ] In `cmd/kube-kg/main.go`, call the `InitTracer()` and `InitMeter()` functions during application startup.
  - [ ] Create a startup span to verify the setup is working correctly.

## Dev Notes

### File Locations & Structure
- `internal/observability/telemetry.go` (New)
- `internal/observability/telemetry_test.go` (New)
- `cmd/kube-kg/main.go` (Modified)

[Source: docs/architecture/09-source-tree.md]

### Technology Stack
- **Observability:** OpenTelemetry 1.24.6

[Source: docs/architecture/03-tech-stack.md]

### Coding Standards
- **Language:** Go 1.24.6
- **Formatting:** `gofmt`
- **Linting:** `golangci-lint`
- **Globals:** No global variables.
- **Initialization:** No `init()` functions.
- **Logging:** Use `slog`.

[Source: docs/architecture/12-coding-standards.md]

### Testing
- **Framework:** Go `testing` package.
- **File Convention:** `_test.go`.
- **Location:** Same package as the code being tested.
- **Coverage:** 80% unit test coverage.
- **AAA Pattern:** Arrange, Act, Assert.

[Source: docs/architecture/13-test-strategy-and-standards.md]

## Change Log

| Date       | Version | Description                | Author |
| :--------- | :------ | :------------------------- | :----- |
| 2025-09-18 | 1.0     | Initial draft of the story. | Bob    |
